function initializeConfig(e){void 0===localStorage.trulyReallyTrulyBeenHereBefore&&(void 0===localStorage.notifications&&localStorage.setItem("notifications",e.notifications),void 0===localStorage.portfolio&&localStorage.setItem("portfolio",e.portfolio),localStorage.setItem("delay",1e3*e.updateDelay),localStorage.setItem("chartPeriod",e.chartPeriod),localStorage.setItem("alertValues",JSON.stringify(e.alertValues)),localStorage.setItem("panicValues",JSON.stringify(e.panicValues)),localStorage.setItem("portfolioValues",JSON.stringify(e.portfolioValues)),localStorage.setItem("sourceCurrency",e.sourceCurrency),localStorage.setItem("targetCurrency",e.targetCurrency),localStorage.setItem("soundNotification",e.soundNotification),localStorage.setItem("colorChange",e.colorChange),localStorage.setItem("lastPrice",0),localStorage.setItem("soundSample","pop"),localStorage.setItem("curs",JSON.stringify(e.curs)),localStorage.setItem("trulyReallyTrulyBeenHereBefore","yes")),setInterval(updateTicker,localStorage.delay)}function getJSON(e,t,o){var a=new XMLHttpRequest;a.open("GET",e,!0),a.onload=function(){if(a.status>=200&&a.status<400){if(t)e=JSON.parse(a.responseText);else var e=JSON.parse(a.responseText).data;o(e)}},a.onerror=function(e){console.log("Coinbase does not respond.")},a.send()}function updateTicker(){getJSON("https://api.coinbase.com/v2/prices/"+localStorage.targetCurrency+"-"+localStorage.sourceCurrency+"/spot",!1,function(e){var t=e.amount,o=e.amount.toString(),a=o;!0===localStorage.colorChange&&(parseFloat(t)>localStorage.lastPrice?(setBadgeColor("#2B8F28"),setTimeout(function(){setBadgeColor("#2E7BC4")},4e3)):parseFloat(t)<localStorage.lastPrice&&(setBadgeColor("#FF4143"),setTimeout(function(){setBadgeColor("#2E7BC4")},4e3))),1==localStorage.roundBadge?t>=100?a=parseFloat(e.amount).toFixed(0).toString():t<100&&(a=parseFloat(e.amount).toFixed(1).toString()):a=o,isEdge&&(a=a.substring(0,4)),browser.browserAction.setBadgeText({text:a}),localStorage.lastPrice=t}),isChrome&&notificationManager(),prefetch(),getChartValues()}function prefetch(){console.log("prefetching");var e,t="https://api.coinbase.com/v2/prices/"+localStorage.targetCurrency+"-"+localStorage.sourceCurrency+"/";getJSON(t+"buy",!1,function(t){e=t.amount,localStorage.setItem("buyPrice",e)}),getJSON(t+"sell",!1,function(t){e=t.amount,localStorage.setItem("sellPrice",e)})}function getChartValues(){var e=0,t="",o=0;switch(localStorage.chartPeriod){case"hour":e=60,t="minute",o=0;break;case"day":e=96,t="minute",o=15;break;case"week":e=84,t="hour",o=2;break;case"month":e=90,t="hour",o=8;break;case"year":e=122,t="day",o=3;break;default:console.log("issue"),e=60,t="minute",o=0}var a=[];getJSON("https://min-api.cryptocompare.com/data/histo"+t+"?fsym="+localStorage.targetCurrency+"&tsym="+localStorage.sourceCurrency+"&limit="+e+"&aggregate="+o+"&useBTC=false",!0,function(t,o){console.log("hello?");for(var r=0;r<t.Data.length;r++)a.push({x:r*(200/e),y:(t.Data[r].close+t.Data[r].open)/2});localStorage.setItem("chartsData",JSON.stringify(a))})}function notificationManager(){if(0!==localStorage.notifications)for(var e=Object.keys(JSON.parse(localStorage.curs)).length,t=0;t<e;t++)getJSON("https://api.coinbase.com/v2/prices/"+JSON.parse(localStorage.curs)[t]+"-"+localStorage.sourceCurrency+"/spot",!1,function(e){var t=e.amount,o=(e.amount.toString(),JSON.parse(localStorage.panicValues)),a=JSON.parse(localStorage.alertValues),r=e.base;parseFloat(t)>a[r]&&a[r]>0?createNotification(browser.i18n.getMessage("strOver"),a[r]):parseFloat(t)<o[r]&&o[r]>0&&createNotification(browser.i18n.getMessage("strUnder"),o[r])})}function setBadgeColor(e){browser.browserAction.setBadgeBackgroundColor({color:e})}function createNotification(e,t){var o=null;browser.notifications.create("price",{type:"basic",title:localStorage.targetCurrency+""+e+t,message:localStorage.targetCurrency+browser.i18n.getMessage("notifTxt")+t,iconUrl:"img/icon80.png",buttons:[{title:browser.i18n.getMessage("coinbaseBtn"),iconUrl:"img/icon.png"}]},function(e){o=e}),0!==parseFloat(localStorage.soundNotification)&&audioNotif()}function audioNotif(){new Audio("sounds/"+localStorage.soundSample+".mp3").play()}function startExtensionListeners(){browser.extension.onMessage.addListener(function(e,t,o){"resetTicker"==e.msg&&updateTicker()}),browser.notifications.onButtonClicked.addListener(function(e,t){browser.tabs.create({url:"https://www.coinbase.com/dashboard"})})}var base_config={sourceCurrency:"EUR",targetCurrency:"ETH",chartPeriod:"day",updateDelay:30,alertValues:{ETH:0,BTC:0,LTC:0,BCH:0},panicValues:{ETH:0,BTC:0,LTC:0,BCH:0},portfolioValues:{ETH:0,BTC:0,LTC:0,BCH:0},curs:{0:"ETH",1:"BTC",2:"LTC",3:"BCH"},soundNotification:1,soundSample:"pop",colorChange:1,roundBadge:0,portfolio:0,notifications:1};window.browser=window.msBrowser||window.browser||window.chrome;var isIE=!!document.documentMode,isEdge=!isIE&&!!window.StyleMedia,isChrome=/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor),_gaq=_gaq||[];_gaq.push(["_setAccount","UA-105414043-1"]),_gaq.push(["_trackPageview"]),function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="https://ssl.google-analytics.com/ga.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}(),initializeConfig(base_config),updateTicker(),startExtensionListeners();