function analytics(){_gaq=[],_gaq.push(["_setAccount","UA-105414043-1"]),_gaq.push(["_trackPageview"]),function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="https://ssl.google-analytics.com/ga.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}(),document.getElementById("coinbaseBtn").onclick=function(){_gaq.push(["_trackEvent","coinbaseButton","clicked"])}.bind(this),document.getElementById("settingsBtn").onclick=function(){browser.tabs.create({url:"options.html"}),_gaq.push(["_trackEvent","settingsButton","clicked"])}.bind(this),document.getElementById("donateBtn").onclick=function(){browser.tabs.create({url:"donate.html"}),_gaq.push(["_trackEvent","donateButton","clicked"])}.bind(this)}function startListeners(){document.querySelector('select[name="chartPeriod"]').onchange=function(e){this.blur(),updateChartPeriod(e)},document.querySelector('input[name="targetPrice"]').onchange=updateAlertValue,document.querySelector('input[name="panicValue"]').onchange=updatePanicValue,document.querySelector('input[name="portfolioSum"]').onchange=updatePortfolioValues,document.querySelector('th[name="ico"').onclick=rollCurrency,document.querySelector('input[name="targetPrice"]').onkeypress=function(e){if(e||(e=window.event),13==(e.keyCode||e.which))return this.blur(),updateAlertValue(e),!1},document.querySelector('input[name="panicValue"]').onkeypress=function(e){if(e||(e=window.event),"13"==(e.keyCode||e.which))return this.blur(),updatePanicValue(e),!1},document.getElementById("settingsBtn").onclick=function(){console.log("hello"),browser.tabs.create({url:"options.html"})}}function changeCurrencyIcon(){"ETH"===localStorage.targetCurrency?(document.querySelector('img[name="currIco"]').src="img/eth16.png",document.querySelector('img[name="currIco2"]').src="img/eth16.png"):"BTC"===localStorage.targetCurrency?(document.querySelector('img[name="currIco"]').src="img/btc16.png",document.querySelector('img[name="currIco2"]').src="img/btc16.png"):(document.querySelector('img[name="currIco"]').src="img/ltc16.png",document.querySelector('img[name="currIco2"]').src="img/ltc16.png")}function rollCurrency(){var e=["BTC","ETH","LTC"],t=e.indexOf(localStorage.targetCurrency)+1;t>2&&(t=0),localStorage.targetCurrency=e[t],changeCurrencyIcon(),updatePrices(),getChartValues(),updateInputValues()}function updateInputValues(){var e=JSON.parse(localStorage.panicValues),t=JSON.parse(localStorage.alertValues),r=JSON.parse(localStorage.portfolioValues);document.querySelector('select[name="chartPeriod"]').value=localStorage.chartPeriod,document.getElementById("tabletitle").innerHTML=localStorage.targetCurrency+" to "+localStorage.sourceCurrency,document.querySelector('input[name="targetPrice"]').value=t[localStorage.targetCurrency],document.querySelector('input[name="panicValue"]').value=e[localStorage.targetCurrency],document.querySelector('input[name="portfolioSum"]').value=r[localStorage.targetCurrency]}function getJSON(e,t){var r=new XMLHttpRequest;r.open("GET",e,!0),r.onload=function(){if(r.status>=200&&r.status<400){var e=JSON.parse(r.responseText);t(e,r)}},r.onerror=function(){document.getElementById("priceNumbers").style.visibility="hidden",document.getElementById("error").style.visibility="visible"},r.send()}function updatePrices(){var e,t,r="https://api.coinbase.com/v2/prices/"+localStorage.targetCurrency+"-"+localStorage.sourceCurrency+"/";getJSON(r+"spot",function(r){document.getElementById("priceNumbers").style.visibility="visible",document.getElementById("error").style.visibility="hidden",e=r.data.amount.toString(),localStorage.lastSpot=r.data.amount,updatePortfolio(),t=r.data.amount,document.getElementById("priceRate").innerHTML=e.toString()}),getJSON(r+"buy",function(r){e=r.data.amount.toString(),t=r.data.amount,document.getElementById("priceBuy").innerHTML=e.toString()}),getJSON(r+"sell",function(r){e=r.data.amount.toString(),t=r.data.amount,document.getElementById("priceSell").innerHTML=e.toString()})}function getChartValues(){var e=0,t="",r=0;switch(localStorage.chartPeriod){case"hour":e=60,t="minute",r=0;break;case"day":e=96,t="minute",r=15;break;case"week":e=84,t="hour",r=2;break;case"month":e=90,t="hour",r=8;break;case"year":e=122,t="day",r=3;break;default:e=60,t="minute",r=0}var n=[];getJSON("https://min-api.cryptocompare.com/data/histo"+t+"?fsym="+localStorage.targetCurrency+"&tsym="+localStorage.sourceCurrency+"&limit="+e+"&aggregate="+r+"&useBTC=false",function(t,r){if("Error"==r.Response)return console.log("No chart data for this currency"),void(document.getElementById("chart").style.display="none");for(var o=0;o<t.Data.length;o++)n.push({x:o*(200/e),y:(t.Data[o].close+t.Data[o].open)/2});buildChart(n);var a=t.Data.length-1,c=(t.Data[0].close+t.Data[0].open)/2,i=100*((t.Data[a].close+t.Data[a].open)/2)/c-100,l=i>0?"+":"",u=i>0?"#2B8F28":"#FF4143";document.querySelector("#changeValue").innerHTML=l+i.toFixed(2)+"%",document.querySelector("#changeValue").style.color=u})}function buildChart(e){var t=document.getElementById("chartCanvas");"undefined"!=typeof priceChart&&priceChart.destroy(),priceChart=new Chart(t,{type:"line",data:{datasets:[{label:"price",fill:!1,data:e,pointRadius:0,borderWidth:2,borderColor:"#2B71B1",lineTension:.1}]},options:{legend:{display:!1},tooltips:{enabled:!1},scales:{xAxes:[{display:!1,type:"linear",position:"bottom"}]},hover:{}}},{lineAtIndex:2})}function updateAlertValue(e){var t=JSON.parse(localStorage.alertValues);t[localStorage.targetCurrency]=e.target.value,localStorage.alertValues=JSON.stringify(t)}function updatePanicValue(e){var t=JSON.parse(localStorage.panicValues);t[localStorage.targetCurrency]=e.target.value,localStorage.panicValues=JSON.stringify(t)}function updatePortfolio(){var e=JSON.parse(localStorage.portfolioValues)[localStorage.targetCurrency].replace(",",".");document.getElementById("cryptoConversion").innerHTML=(e*localStorage.lastSpot).toFixed(2)+" "+localStorage.sourceCurrency}function updatePortfolioValues(e){var t=JSON.parse(localStorage.portfolioValues);t[localStorage.targetCurrency]=e.target.value,localStorage.portfolioValues=JSON.stringify(t),updatePortfolio()}function togglePortfolio(e){switch(e){case"0":document.getElementById("portfolio").style.visibility="hidden",document.getElementById("portfolio").style.height="0px",document.getElementById("portfolio").style.marginTop="0px",document.getElementById("portfolio").style.padding="0px";break;case"1":document.getElementById("portfolio").style.visibility="visible",document.getElementById("portfolio").style.height="auto",document.getElementById("portfolio").style.marginTop="5px";break;default:console.log("error",e)}}function translate(){document.getElementById("strSpotrate").innerHTML=browser.i18n.getMessage("strSpotrate"),document.getElementById("strBuyPrice").innerHTML=browser.i18n.getMessage("strBuyPrice"),document.getElementById("strSellPrice").innerHTML=browser.i18n.getMessage("strSellPrice"),document.getElementById("strTargetPrice").innerHTML=browser.i18n.getMessage("strTargetPrice"),document.getElementById("strPanicPrice").innerHTML=browser.i18n.getMessage("strPanicPrice"),document.getElementById("strHour").innerHTML=browser.i18n.getMessage("strHour"),document.getElementById("strDay").innerHTML=browser.i18n.getMessage("strDay"),document.getElementById("strWeek").innerHTML=browser.i18n.getMessage("strWeek"),document.getElementById("strMonth").innerHTML=browser.i18n.getMessage("strMonth"),document.getElementById("strYear").innerHTML=browser.i18n.getMessage("strYear"),document.getElementById("coinbaseBtn").innerHTML=browser.i18n.getMessage("coinbaseBtn"),document.getElementById("settingsBtn").innerHTML=browser.i18n.getMessage("settingsBtn"),document.getElementById("strLast").innerHTML=browser.i18n.getMessage("strLast")}function hideUselessFields(){document.querySelector('div[id="limitOptions"]').style.visibility="hidden",document.querySelector('div[id="limitOptions"]').style.height="0px"}function updateChartPeriod(e){localStorage.chartPeriod=e.target.value,getChartValues()}document.addEventListener("DOMContentLoaded",function(){/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor);var e=!!window.opr&&!!opr.addons||!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0,t="undefined"!=typeof InstallTrigger,r=!!document.documentMode,n=!r&&!!window.StyleMedia,o=localStorage.portfolio;startListeners(),updateInputValues(),togglePortfolio(o.toString()),updatePrices(),updatePortfolio(),changeCurrencyIcon(),getChartValues(),analytics(),translate(),(e||t||r||n)&&hideUselessFields()}),window.browser=window.msBrowser||window.browser||window.chrome;